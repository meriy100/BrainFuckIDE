<!DOCTYPE html>
<html lang="ja">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="/public/Skeleton-2.0.4/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/public/Skeleton-2.0.4/css/skeleton.css" />
    <link rel="stylesheet" type="text/css" href="node_modules/codemirror/lib/codemirror.css" />
    <link rel="stylesheet" type="text/css" href="node_modules/codemirror/theme/material.css" />
    <style>
        .CodeMirror {
            font-family: Monaco, 'Andale Mono', 'Lucida Console', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;
        }
    </style>

    <script src="index.js"></script>
    <script src="node_modules/codemirror/lib/codemirror.js"></script>
    <script src="node_modules/codemirror/mode/brainfuck/brainfuck.js"></script>
    <title>BrainF*ck IDE</title>
</head>
<body>
    <div id="elm-node"></div>
    <script>
        var app = Elm.Main.init({node: document.getElementById("elm-node")});
        var initializer = setInterval(function () {
            var textarea = document.getElementById("editor");
            if (!textarea) {
                return;
            }
            var editor = CodeMirror.fromTextArea(textarea, {
                lineNumbers: true,
                mode:  "brainfuck",
                theme: "material"
            });
            editor.on('change', () => {
                app.ports.codeOnInput.send(editor.doc.getValue());
                console.log(editor.doc.getValue());
            });
            editor.setOption("extraKeys", {
                ["Ctrl-S"]: function (cm) {
                    app.ports.save.send(editor.doc.getValue());
                },
                ["Cmd-S"]: function (cm) {
                    app.ports.save.send(editor.doc.getValue());
                }
            });
            clearInterval(initializer);
        }, 10);
    </script>
</body>
</html>
